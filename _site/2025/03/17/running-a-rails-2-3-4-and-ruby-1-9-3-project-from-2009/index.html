<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running a Rails 2.3.4 and Ruby 1.9.3 Project from 2009! - Leo&#39;s Blog - leonardopereira.com</title>
<meta name="description" content="Yesterday I got an e-mail from Squarespace, informing me that my Google Domains account (now on Squarespace) would increase the price since Gemini and AI are...">

<!-- Stylesheets -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/css/main.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" rel="stylesheet">

<!-- Feed and SEO tag -->
<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Leo&apos;s Blog - leonardopereira.com" />
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Running a Rails 2.3.4 and Ruby 1.9.3 Project from 2009! | Leo’s Blog - leonardopereira.com</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Running a Rails 2.3.4 and Ruby 1.9.3 Project from 2009!" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Yesterday I got an e-mail from Squarespace, informing me that my Google Domains account (now on Squarespace) would increase the price since Gemini and AI are costing more and in every product of theirs. Which is horrible, I don’t think they add any value and it’s impossible to opt-out. So, I started digging and seeing how I could make things cheaper so at least from my side, Google would not get all the greenies it wants. Well, one of the tools I decided to use was to find heavy files in my Gmail, Google Photos and Google Drive." />
<meta property="og:description" content="Yesterday I got an e-mail from Squarespace, informing me that my Google Domains account (now on Squarespace) would increase the price since Gemini and AI are costing more and in every product of theirs. Which is horrible, I don’t think they add any value and it’s impossible to opt-out. So, I started digging and seeing how I could make things cheaper so at least from my side, Google would not get all the greenies it wants. Well, one of the tools I decided to use was to find heavy files in my Gmail, Google Photos and Google Drive." />
<link rel="canonical" href="http://localhost:4000/2025/03/17/running-a-rails-2-3-4-and-ruby-1-9-3-project-from-2009/" />
<meta property="og:url" content="http://localhost:4000/2025/03/17/running-a-rails-2-3-4-and-ruby-1-9-3-project-from-2009/" />
<meta property="og:site_name" content="Leo’s Blog - leonardopereira.com" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-03-17T23:07:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Running a Rails 2.3.4 and Ruby 1.9.3 Project from 2009!" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-03-17T23:07:00-04:00","datePublished":"2025-03-17T23:07:00-04:00","description":"Yesterday I got an e-mail from Squarespace, informing me that my Google Domains account (now on Squarespace) would increase the price since Gemini and AI are costing more and in every product of theirs. Which is horrible, I don’t think they add any value and it’s impossible to opt-out. So, I started digging and seeing how I could make things cheaper so at least from my side, Google would not get all the greenies it wants. Well, one of the tools I decided to use was to find heavy files in my Gmail, Google Photos and Google Drive.","headline":"Running a Rails 2.3.4 and Ruby 1.9.3 Project from 2009!","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2025/03/17/running-a-rails-2-3-4-and-ruby-1-9-3-project-from-2009/"},"url":"http://localhost:4000/2025/03/17/running-a-rails-2-3-4-and-ruby-1-9-3-project-from-2009/"}</script>
<!-- End Jekyll SEO tag -->


<link rel="icon" type="image/x-icon" href="/assets/favicon/favicon.ico"> 
</head>
<body>
  <div class="container-fluid base">
    <div class="top-40px">
      <div class="header-row">
        <div class="header-left">
          <div class="dots-container">
            <span class="dot bg-violet"></span>
            <span class="dot bg-capri"></span>
            <span class="dot bg-white"></span>
          </div>
          <h1 class="site-title"><a href="/" class="site-title-link">Leo's Blog</a></h1>
        </div>
        <div class="return-button">
          
            <a href="/" class="btn btn-profile">Back to Blog</a>
          
        </div>
      </div>
      
      <div class="header-content-separator">
        <div class="custom-hr"></div>
      </div>
      
      <main class="page-content">
        <article class="post">
  <header class="post-header">
    <h1 class="post-title">Running a Rails 2.3.4 and Ruby 1.9.3 Project from 2009!</h1>
    <div class="post-meta">
      <time datetime="2025-03-17T23:07:00-04:00">
        Mar 17, 2025
      </time>
      
      
      <span class="post-categories">
        • Categories: 
        
        <a href="/categories/#programming">programming</a>, 
        
        <a href="/categories/#ai">ai</a>, 
        
        <a href="/categories/#back-to-the-past">back to the past</a>
        
      </span>
      
    </div>
  </header>

  <div class="header-content-separator">
    <div class="custom-hr"></div>
  </div>

  <div class="post-content">
    <p>Yesterday I got an e-mail from Squarespace, informing me that my Google Domains account (now on Squarespace) would increase the price since Gemini and AI are costing more and in every product of theirs. Which is horrible, I don’t think they add any value and it’s impossible to opt-out.
So, I started digging and seeing how I could make things cheaper so at least from my side, Google would not get all the greenies it wants. Well, one of the tools I decided to use was to find heavy files in my Gmail, Google Photos and Google Drive.</p>

<p>Out of curiosity, I found a Git bundle of a project I was part of in 2009. It was my first real Ruby project, getting my hands dirty. The project was Sportlog, a community driven by exercises and milestones, very similar to what Strava is nowadays. Unfortunately, it didn’t work out, and the project was closed in 2010.
Curious as I am, I had to see what was there, right now.
So, I ran:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone ~/Downloads/Sportlog.git.bundle
</code></pre></div></div>

<p>And to my wonder all the files were there! Like looking into the past:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mar 17 15:15 Capfile
Mar 17 15:15 README
Mar 17 22:21 Rakefile
Mar 17 15:15 app
Mar 17 21:49 config
Mar 17 15:15 db
Mar 17 15:15 doc
Mar 17 15:15 lang
Mar 17 15:15 lib
Mar 17 21:28 log
Mar 17 21:24 patches
Mar 17 15:15 public
Mar 17 15:15 script
Mar 17 15:15 test
Mar 17 15:15 themes
Mar 17 21:57 tmp
Mar 17 15:15 utils
Mar 17 15:15 vendor
</code></pre></div></div>

<p>Finally! So now, how can I run a project from 15 years ago? It will take a long time to upgrade everything, and I will need to do it in steps. From Rails 2, to 3, and then 4 and etc. And in version 3, <a href="https://yehudakatz.com/2008/12/23/rails-and-merb-merge/">Ruby on Rails and Merb merged</a>, so it was a <strong>lot</strong> of changes to handle. Impossible.</p>

<p>But nowadays we have a series of tools that can actually make us move to the past and accomplish this: <strong>Docker</strong> and <strong>AI</strong>.</p>

<p>With that in mind, I opened Cursor with my project, gave the first instructions and started a battle of instructions that lasted for almost 2 hours. But something was also missing: the database. The migrations were there, but I did not have similar data to work with. Lucky me, in my e-mail was also a copy of the database we used during development (almost 15 years ago we handled everything through e-mails), Dropbox and others were brand new. 
With all that in place, here is my current git status:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  Sportlog.git git:(master) ✗ git st
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git restore &lt;file&gt;..." to discard changes in working directory)
  (commit or discard the untracked or modified content in submodules)
        modified:   Rakefile
        modified:   app/controllers/application_controller.rb
        modified:   app/controllers/sportlog_sessions_controller.rb
        modified:   app/helpers/application_helper.rb
        modified:   app/helpers/base_helper.rb
        modified:   config/deploy.rb
        modified:   config/environment.rb
        modified:   config/environments/production.rb
        modified:   config/gmaps_api_key.yml
        modified:   config/locales/pt.yml
        modified:   lang/ui/en-US.yml
        modified:   lang/ui/pt-BR.yml
        modified:   themes/sportlog_v1/views/comments/_comment_form.html.erb
        modified:   themes/sportlog_v1/views/comments/_comment_form_training.html.erb
        modified:   themes/sportlog_v1/views/shared/_user_menu.html.erb
        modified:   vendor/plugins/community_engine (new commits, modified content, untracked content)
        modified:   vendor/plugins/ym4r_gm/lib/gm_plugin/key.rb
        modified:   vendor/rails/activesupport/lib/active_support/locale/en.yml
        modified:   vendor/rails/railties/lib/rails/gem_dependency.rb
        modified:   vendor/rails/railties/lib/rails/plugin/loader.rb

Untracked files:
  (use "git add &lt;file&gt;..." to include in what will be committed)
        .dockerignore
        Dockerfile
        README.md
        app/helpers/info_helper.rb
        app/helpers/sportlog_base_helper.rb
        app/helpers/sportlog_helper.rb
        app/helpers/sportlog_posts_helper.rb
        app/helpers/sportlog_sessions_helper.rb
        app/helpers/sportlog_users_helper.rb
        app/helpers/trainings_helper.rb
        config/initializers/desert_compatibility.rb
        config/initializers/desert_object_patch.rb
        config/initializers/encoding_fixes.rb
        config/initializers/gem_compatibility.rb
        config/initializers/i18n_config.rb
        config/initializers/md5_compatibility.rb
        config/initializers/missing_plugins_handler.rb
        config/initializers/rails_2_3_4_compatibility.rb
        config/initializers/ruby193_compatibility.rb
        config/initializers/ruby19_encoding_fixes.rb
        config/initializers/ruby20_compatibility.rb
        config/initializers/skip_missing_plugins.rb
        config/initializers/utf8_templates.rb
        config/preinitializer.rb
        docker-compose.yml
        patches/
        sportlog-2010-02-26.sql
        "themes/sportlog_v1/images/events/foto Corporate Run S\303\243o Paulo.jpg"
        vendor/plugins/white_list/
</code></pre></div></div>

<p>The main changes:</p>
<ul>
  <li>Several monkey patches to support outdated code in libraries dead for a long time. AI shined here.</li>
  <li>Update of locales. Most of this project was written in Brazilian Portuguese, and the encoding at the time was extremely painful. I did several changes to just remove the magic words, for example “Administração” contains 2 encoded characters not common to English language, and I just modified it to be “Administracao”, no special characters, no weird encoding errors.</li>
  <li>For some reason, several helpers were missing. I think Cursor modified something to always expect a non-existing helper, so I had to add several for the pages I navigated.</li>
  <li>Restoring old plugins (think like Engines), had to go through all the versions in an archived project (community_engine) and get the correct Rails version.</li>
  <li>Removing keys and e-mails so I don’t message anyone from my old team <code class="language-plaintext highlighter-rouge">¯\_(ツ)_/¯</code> after all, I don’t own this code.</li>
  <li>Fixes and fixes! Several, from a wrong column in the database to weird ASCII characters.</li>
</ul>

<p>Btw! This is how we used to run <code class="language-plaintext highlighter-rouge">rails console</code> in the past:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose <span class="nb">exec </span>web script/console
</code></pre></div></div>

<p>which executes:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env ruby</span>
<span class="nb">require</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../../config/boot'</span><span class="p">,</span>  <span class="kp">__FILE__</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">'commands/console'</span>
</code></pre></div></div>

<p>And after some time, it was running:
<img src="/assets/images/sportlog1.png" alt="Sportlog Home Page" />
<img src="/assets/images/sportlog2.png" alt="Sportlog Training Panel" /></p>

<p>This is so exciting! So many memories. And so many interesting things! Now, let’s look at the code.</p>

<p>Today we have <code class="language-plaintext highlighter-rouge">refute</code> and <code class="language-plaintext highlighter-rouge">assert</code> on Minitest, in 2009, not quite:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">ExerciseMachineBrandTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="nb">test</span> <span class="s2">"presence of name"</span> <span class="k">do</span>
    <span class="n">brand</span> <span class="o">=</span> <span class="n">create_exercise_machine_brand</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">)</span>
    <span class="n">assert</span> <span class="o">!</span> <span class="n">brand</span><span class="p">.</span><span class="nf">valid?</span>
    <span class="n">assert</span> <span class="n">brand</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
    
    <span class="n">brand</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s1">'brand'</span>
    <span class="n">assert</span> <span class="n">brand</span><span class="p">.</span><span class="nf">valid?</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>So, it was <code class="language-plaintext highlighter-rouge">assert ! object.valid?</code> to verify if it was false? A bit interesting. And I was quite happy to see a lot of functional tests. Which btw, this is the whole tests structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fixtures
functional
integration
javascript
jmeter.jmx
performance
test_helper.rb
unit
</code></pre></div></div>

<p>A bit different from what we have today.</p>

<p>Functional tests were not so different from what we have today too:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">SportlogCommentsControllerTest</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="kp">alias_method</span> <span class="ss">:assert_difference_original</span><span class="p">,</span> <span class="ss">:assert_difference</span>

  <span class="kp">include</span> <span class="no">AuthenticatedTestHelper</span>
  
  <span class="k">def</span> <span class="nf">setup</span>
    <span class="n">login_as</span><span class="p">(</span><span class="ss">:rodrigo</span><span class="p">)</span>    
  <span class="k">end</span>
  
  <span class="nb">test</span> <span class="s2">"should create a post comment"</span> <span class="k">do</span>
    <span class="n">assert_difference_original</span><span class="p">(</span><span class="s1">'Comment.count'</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:post_id</span> <span class="o">=&gt;</span> <span class="n">posts</span><span class="p">(</span><span class="ss">:funny_post</span><span class="p">),</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="s2">"testing"</span> <span class="p">},</span> <span class="ss">:locale</span> <span class="o">=&gt;</span> <span class="s2">"pt"</span>
    <span class="k">end</span>
    
    <span class="n">assert_redirected_to</span> <span class="n">dashboard_user_path</span><span class="p">(</span><span class="n">posts</span><span class="p">(</span><span class="ss">:funny_post</span><span class="p">).</span><span class="nf">user</span><span class="p">)</span>
    
    <span class="n">assert_no_difference</span><span class="p">(</span><span class="no">Comment</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:post_id</span> <span class="o">=&gt;</span> <span class="n">posts</span><span class="p">(</span><span class="ss">:not_funny_post</span><span class="p">),</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="s2">"should not be possible"</span> <span class="p">},</span> <span class="ss">:locale</span> <span class="o">=&gt;</span> <span class="s2">"pt"</span>
    <span class="k">end</span>
    
    <span class="n">assert_redirected_to</span> <span class="n">dashboard_user_path</span><span class="p">(</span><span class="n">users</span><span class="p">(</span><span class="ss">:edgard</span><span class="p">))</span>

    <span class="vi">@request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s1">'HTTP_ACCEPT'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'text/javascript'</span>
    
    <span class="n">assert_difference_original</span><span class="p">(</span><span class="s1">'Comment.count'</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:post_id</span> <span class="o">=&gt;</span> <span class="n">posts</span><span class="p">(</span><span class="ss">:funny_post</span><span class="p">),</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="s2">"testing"</span> <span class="p">},</span> <span class="ss">:locale</span> <span class="o">=&gt;</span> <span class="s2">"pt"</span>
    <span class="k">end</span>
    
    <span class="n">assert_response</span> <span class="ss">:success</span>
    
    <span class="n">assert_no_difference</span><span class="p">(</span><span class="no">Comment</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:post_id</span> <span class="o">=&gt;</span> <span class="n">posts</span><span class="p">(</span><span class="ss">:not_funny_post</span><span class="p">),</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="s2">"should not be possible"</span> <span class="p">},</span> <span class="ss">:locale</span> <span class="o">=&gt;</span> <span class="s2">"pt"</span>
    <span class="k">end</span>
    
    <span class="n">assert_response</span> <span class="ss">:unauthorized</span>

    <span class="n">assert_no_difference</span><span class="p">(</span><span class="no">Comment</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:training_id</span> <span class="o">=&gt;</span> <span class="n">trainings</span><span class="p">(</span><span class="ss">:one</span><span class="p">),</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:comment</span> <span class="o">=&gt;</span> <span class="s2">"should not be possible"</span> <span class="p">},</span> <span class="ss">:locale</span> <span class="o">=&gt;</span> <span class="s2">"pt"</span>
    <span class="k">end</span>

    <span class="n">assert_response</span> <span class="ss">:unauthorized</span>
  <span class="k">end</span>
  
  <span class="nb">test</span> <span class="s2">"should redirect properly"</span> <span class="k">do</span>
    <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="p">{</span><span class="s2">"comment"</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">"comment"</span><span class="o">=&gt;</span><span class="s2">"asfsdf"</span><span class="p">},</span> <span class="s2">"commit"</span><span class="o">=&gt;</span><span class="s2">"comentar"</span><span class="p">,</span> <span class="s2">"training_id"</span><span class="o">=&gt;</span> <span class="n">trainings</span><span class="p">(</span><span class="ss">:one</span><span class="p">),</span> <span class="s2">"action"</span><span class="o">=&gt;</span><span class="s2">"create"</span><span class="p">,</span> <span class="s2">"locale"</span><span class="o">=&gt;</span><span class="s2">"pt"</span><span class="p">}</span>
    <span class="n">assert_redirected_to</span> <span class="n">dashboard_user_path</span><span class="p">(</span><span class="n">trainings</span><span class="p">(</span><span class="ss">:one</span><span class="p">).</span><span class="nf">milestone</span><span class="p">.</span><span class="nf">user</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>I can see many differences and many things I would write differently too, but nonetheless, I can easily understand this. And this is the magic Ruby on Rails introduced a long time ago. Ruby is Poetry.</p>

<p>Now, investigating a few different files. Here is the models/post.rb:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Post</span><span class="o">&lt;</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:recipient</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s2">"User"</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="s2">"recipient_id"</span>
  
  <span class="n">tracks_unlinked_activities</span> <span class="p">[</span><span class="ss">:post_received</span><span class="p">,</span> <span class="ss">:post_to_myself</span><span class="p">]</span>
  
  <span class="k">def</span> <span class="nf">create_activity_from_self</span>
    <span class="c1"># Just needed cause of duplication of post feed</span>
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">send_notifications</span>
    <span class="no">SportlogUserNotifier</span><span class="p">.</span><span class="nf">deliver_post</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">should_notify_recipient?</span>
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">should_notify_recipient?</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="n">recipient</span>
    <span class="k">return</span> <span class="kp">false</span> <span class="k">if</span> <span class="n">recipient</span><span class="p">.</span><span class="nf">eql?</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="kp">true</span>    
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">username</span>
    <span class="n">user</span><span class="p">.</span><span class="nf">full_name</span> 
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">owner</span>
  	<span class="k">return</span> <span class="n">recipient</span><span class="p">.</span><span class="nf">blank?</span> <span class="p">?</span> <span class="n">user</span> <span class="p">:</span> <span class="n">recipient</span>
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">can_be_deleted_by?</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
     <span class="n">person</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">person</span><span class="p">.</span><span class="nf">admin?</span> <span class="o">||</span> <span class="n">person</span><span class="p">.</span><span class="nf">id</span><span class="p">.</span><span class="nf">eql?</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="o">||</span> <span class="n">person</span><span class="p">.</span><span class="nf">id</span><span class="p">.</span><span class="nf">eql?</span><span class="p">(</span><span class="n">recipient_id</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">commentable?</span><span class="p">(</span><span class="n">commenter</span><span class="p">)</span>
    <span class="o">!</span> <span class="p">(</span><span class="n">commenter</span><span class="p">.</span><span class="nf">blank?</span> <span class="ow">or</span> <span class="p">(</span><span class="o">!</span><span class="n">user</span><span class="p">.</span><span class="nf">blank?</span> <span class="ow">and</span> <span class="n">user</span> <span class="o">!=</span> <span class="n">commenter</span> <span class="ow">and</span> <span class="o">!</span><span class="no">Friendship</span><span class="p">.</span><span class="nf">friends?</span><span class="p">(</span><span class="n">commenter</span><span class="p">,</span> <span class="n">user</span><span class="p">)))</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Several things to notice here:</p>
<ul>
  <li>The lack of space on <code class="language-plaintext highlighter-rouge">class Post&lt;ActiveRecord::Base</code> kills me 😂. First refactor: <code class="language-plaintext highlighter-rouge">class Post &lt; ActiveRecord::Base</code>.</li>
  <li>Ruby hash rocket all over the place.</li>
  <li>A lot of inexperienced code too “return”, but in Ruby, every method returns something. That one was my fault!</li>
  <li>A lot of <code class="language-plaintext highlighter-rouge">and</code> and <code class="language-plaintext highlighter-rouge">or</code>. Very weird, and I don’t think that was on purpose.</li>
</ul>

<p>And another list of strange things:</p>

<ul>
  <li>This line: <code class="language-plaintext highlighter-rouge">flash[:notice] = :youve_been_logged_out_hope_you_come_back_soon.l</code> Why not I18n.l()?</li>
  <li>A lot of <code class="language-plaintext highlighter-rouge">format.xml</code>, looks like it was still a thing. Not sure why supported in this project, though.</li>
  <li>A lot of <code class="language-plaintext highlighter-rouge">define_method</code> for no good reason.</li>
  <li>The font size was very small.</li>
  <li>A lot of <code class="language-plaintext highlighter-rouge">form_remote_for</code> and <code class="language-plaintext highlighter-rouge">jQuery</code>, I mean, look at this beauty:</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%</span> <span class="na">form_remote_for</span><span class="err">(</span><span class="na">:comment</span><span class="err">,</span> 
  <span class="na">:before =</span><span class="err">&gt; </span><span class="s">" if(jQuery('#comment_textarea_#{item_id}').val() == '') { alert('Seu comentario nao pode ser vazio.'); jQuery('#comment_textarea_#{item_id}').focus(); return false; } "</span><span class="err">,</span>
  <span class="na">:loading =</span><span class="err">&gt; </span><span class="s">" jQuery('#form_loader_#{item_id}').show(); jQuery('#comment_sub_#{item_id}').hide(); $$('div#comments div.errors')[0].innerHTML = ''; $('comment_spinner').show(); "</span><span class="err">,</span> 
  <span class="na">:url =</span><span class="err">&gt; </span><span class="s">comments_url(commentable.class.to_s.underscore,</span> <span class="na">commentable.id</span> <span class="err">),</span> 
  <span class="na">:update =</span><span class="err">&gt; </span><span class="s">"comment_form_#{item_id}"</span><span class="err">,</span> 
  <span class="na">:position =</span><span class="err">&gt; </span><span class="s">'before'</span><span class="err">,</span> 
  <span class="na">:success =</span><span class="err">&gt; </span><span class="s">" jQuery('#form_loader_#{item_id}').hide(); jQuery('#comment_d_#{item_id}').fadeOut('slow'); jQuery('#comment_textarea_#{item_id}').val(''); jQuery('#comment_sub_#{item_id}').show(); cycleCommentList('comment_list_#{item_id}');"</span><span class="err">,</span>  
  <span class="na">:failure =</span><span class="err">&gt; </span><span class="s">"alert('#{I18n.translate(:not_allowed)}');jQuery('#form_loader_#{item_id}').hide();"</span><span class="err">,</span>
  <span class="na">:html =</span><span class="err">&gt; </span><span class="s">{:id</span> <span class="err">=</span><span class="nt">&gt;</span> 'new_comment_form', :class =&gt; "MainForm"}) do |f| %&gt;
      <span class="nt">&lt;fieldset&gt;</span>
        <span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">"comment_textarea_&lt;%= item_id %&gt;"</span> <span class="na">class=</span><span class="s">"ta-a"</span> <span class="na">rows=</span><span class="s">"5"</span> <span class="na">name=</span><span class="s">"comment[comment]"</span> <span class="na">cols=</span><span class="s">"86"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
        <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">f.submit</span> <span class="err">"</span><span class="na">comentar</span><span class="err">",</span> <span class="na">:class =</span><span class="err">&gt; </span><span class="s">"bt-style-c right"</span><span class="err">,</span> <span class="na">:id =</span><span class="err">&gt; </span><span class="s">"comment_sub_#{item_id}"</span> <span class="err">%</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"form_loader_&lt;%= item_id %&gt;"</span> <span class="na">class=</span><span class="s">"loader_comment right"</span> <span class="na">style=</span><span class="s">"display: none;"</span><span class="nt">&gt;&lt;</span><span class="err">%=</span> <span class="na">image_tag</span> <span class="err">"</span><span class="na">theme</span><span class="err">/</span><span class="na">ajax-loader.gif</span><span class="err">"</span> <span class="err">%</span><span class="nt">&gt;&lt;/div&gt;</span>	    
      <span class="nt">&lt;/fieldset&gt;</span>
<span class="nt">&lt;</span><span class="err">%</span><span class="na">end</span><span class="err">%</span><span class="nt">&gt;</span> 
</code></pre></div></div>

<p>A lot of design ideas missing from this implementation, which makes sense, most of the developers came from Web Agencies and had no knowledge of Design Principles.</p>

<hr />

<p>Well, this was a very interesting problem. Going to the past and seeing how things worked, deployment techniques, Rack sending e-mails to notify of bugs in production and much more. Glad to see how far we have come!</p>

<p>Hope you liked going to the past with me.</p>

<p><span style="color: #F2C94C;">Happy coding!</span></p>

  </div>

  

  <div class="post-navigation-separator">
    <div class="custom-hr"></div>
  </div>

  <div class="post-navigation">
    <div class="post-navigation-prev">
      
      <a href="/2025/03/12/ai-cursor-and-speeding-up-development/" title="AI, Cursor and speeding up development">
        &laquo; AI, Cursor and speeding up ...
      </a>
      
    </div>
    <div class="post-navigation-next">
      
    </div>
  </div>
</article>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get all links within the post content only (not navigation or other areas)
    const postContentLinks = document.querySelector('.post-content').getElementsByTagName('a');
    
    // For each link in the post content
    for (let i = 0; i < postContentLinks.length; i++) {
      const link = postContentLinks[i];
      
      // Skip links that are already set to open in a new window
      if (!link.hasAttribute('target')) {
        link.setAttribute('target', '_blank');
        link.setAttribute('rel', 'noopener noreferrer');
      }
      
      // Skip links to the same site (internal links)
      if (link.hostname === window.location.hostname) {
        link.removeAttribute('target');
        link.removeAttribute('rel');
      }
    }
  });
</script> 
      </main>
    </div>
  </div>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PB8KG1169H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-PB8KG1169H');
  </script>
</body>
</html> 